<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Table</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- jQuery UI (autocomplete) -->
  <link
    rel="stylesheet"
    href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"
  >
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
</head>

<body class="p-4">

<div class="container">
  <h4 class="mb-3">Data Table</h4>

  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Condition</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="dataTable">
      <!-- rows generated dynamically -->
    </tbody>
  </table>
</div>

<script>
let conditionSource = [];

// Load conditions
$.getJSON("conditions.json", function (conditions) {
  conditionSource = conditions;
});

// Load main data
$.getJSON("data.json", function (data) {
  data.forEach((row, index) => {
    const [id, name, date] = row;

    const tr = $(`
      <tr>
        <td>${date}</td>
        <td>${name}</td>
        <td>
          <input
            type="text"
            class="form-control condition-input"
            data-row="${index}"
          >
        </td>
        <td>
          <button class="btn btn-sm btn-primary">Save</button>
        </td>
      </tr>
    `);

    $("#dataTable").append(tr);
  });

  initAutocomplete();
});

function initAutocomplete() {
  $(".condition-input").autocomplete({
    minLength: 1,
    source: function (request, response) {
      const term = request.term.toLowerCase();

      const results = conditionSource
        .filter(item =>
          item[0].toLowerCase().includes(term) ||
          item[1].toLowerCase().includes(term)
        )
        .map(item => ({
          label: `${item[0]} â€“ ${item[1]}`,
          value: item[0]
        }));

      response(results);
    }
  });
}
</script>

</body>
</html>
